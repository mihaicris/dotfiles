#!/usr/bin/env zsh

heading "Change Development Environement"

ENVIRONMENTS=(
    'Production;https://www.adoreme.com'
    'Delta 1;http://magento-ns-delta-1.stg.adoreme.com'
    'Delta 2;http://magento-ns-delta-2.stg.adoreme.com'
    'Delta 3;http://magento-ns-delta-3.stg.adoreme.com'
    'Gamma 1;http://magento-ns-gamma-1.stg.adoreme.com'
    'Gamma 2;http://magento-ns-gamma-2.stg.adoreme.com'
    'Gamma 3;http://magento-ns-gamma-3.stg.adoreme.com'
    'Sigma 1;http://magento-ns-sigma-1.stg.adoreme.com'
    'Sigma 2;http://magento-ns-sigma-2.stg.adoreme.com'
    'Sigma 3;http://magento-ns-sigma-3.stg.adoreme.com'
    'Omega 1;http://magento-ns-omega-1.stg.adoreme.com'
    'Omega 2;http://magento-ns-omega-2.stg.adoreme.com'
    'Omega 3;http://magento-ns-omega-3.stg.adoreme.com'
)
NAMES=()
BASEURLS=()

for ENVIRONMENT in $ENVIRONMENTS; do
    IFS=";" read -r -A arr <<< "${ENVIRONMENT}"
    NAMES=("${NAMES[@]}" "${arr[1]}")
    BASEURLS=("${BASEURLS[@]}" "${arr[2]}")
done
export COLUMNS=1
select NAME in $NAMES; do
    if [[ -n $NAME ]]; then
        break
    else
        print "Wrong selection."
    fi
done

BASEURL=${BASEURLS[$REPLY]}

#iOS
find Targets \
    -name "URLs.plist" \
    -print \
    -exec /usr/libexec/PlistBuddy \
    -c "Set :BaseUrl ${BASEURL}" \
    -c "Set :FrontendWebUrl ${BASEURL}/?is_adoreme_webview=true" \
    {} \;

# Adnroid

PATTERN="\"BASE_URL\", \'\"\(.*\)\"\'"
REPLACE="\"BASE_URL\", \'\"${BASEURL}\/\"\'"

find ../android/app \
    -name "build.gradle" \
    -print \
    -exec sed -i "" -e "s|${PATTERN}|${REPLACE}|" \
    {} \;
